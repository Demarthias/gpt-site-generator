<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Website Preview & Editor with Images & AI</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    #controls {
      width: 360px;
      background: #fff;
      padding: 1.5rem;
      box-shadow: 2px 0 12px rgba(0, 0, 0, 0.08);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }
    #controls h2 {
      margin-top: 0;
      margin-bottom: 1rem;
      font-weight: 700;
      font-size: 1.5rem;
      text-align: center;
    }
    label {
      display: block;
      margin-top: 1rem;
      font-weight: 600;
      font-size: 0.9rem;
    }
    select,
    input[type='text'],
    input[type='color'],
    textarea {
      width: 100%;
      margin-top: 0.25rem;
      padding: 0.5rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.9rem;
      resize: vertical;
      font-family: inherit;
    }
    textarea {
      min-height: 80px;
    }
    button {
      margin-top: 1.5rem;
      padding: 0.8rem 1.5rem;
      background: #4a90e2;
      color: white;
      font-weight: 700;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #357ab8;
    }
    #randomizeBtn {
      background: #e67e22;
      margin-top: 0.5rem;
    }
    #randomizeBtn:hover {
      background: #cf711c;
    }
    #preview {
      flex: 1;
      border: none;
      height: 100vh;
      background: white;
      border-left: 1px solid #ddd;
    }
    input[type='file'] {
      margin-top: 0.5rem;
    }
    #aiGenerator {
      margin-top: 1rem;
      border: 1px solid #ccc;
      padding: 0.8rem;
      border-radius: 6px;
      background: #fafafa;
    }
    #aiGenerator label {
      margin-top: 0;
    }
    #aiPrompt {
      width: 100%;
      padding: 0.5rem;
      font-size: 0.9rem;
      margin-top: 0.25rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-family: inherit;
      resize: vertical;
      min-height: 60px;
    }
    #generateAI {
      background: #27ae60;
      margin-top: 0.75rem;
    }
    #generateAI:hover {
      background: #1e8449;
    }
  </style>
</head>
<body>
  <div id="controls">
    <h2>Website Editor</h2>

    <label for="sectionSelector">Select Section</label>
    <select id="sectionSelector"></select>

    <label for="sectionText">Edit Section HTML</label>
    <textarea id="sectionText" placeholder="Edit the inner HTML"></textarea>

    <label for="sectionColor">Text Color</label>
    <input type="color" id="sectionColor" />

    <label for="bgType">Background Type</label>
    <select id="bgType">
      <option value="color">Color</option>
      <option value="image">Image URL</option>
    </select>

    <input type="color" id="bgColor" style="margin-top: 0.25rem;" />
    <input
      type="text"
      id="bgImage"
      placeholder="Background Image URL"
      style="display: none; margin-top: 0.5rem;"
    />

    <label for="theme">Theme</label>
    <select id="theme">
      <option value="modern">Modern</option>
      <option value="classic">Classic</option>
      <option value="minimal">Minimal</option>
      <option value="vibrant">Vibrant</option>
      <option value="dark">Dark</option>
    </select>

    <label for="imageUploader">Upload Image to Section</label>
    <input type="file" id="imageUploader" accept="image/*" />

    <div id="aiGenerator">
      <label for="aiPrompt">AI Image Generator Prompt</label>
      <textarea
        id="aiPrompt"
        placeholder="Describe the image you want to generate..."
      ></textarea>
      <button id="generateAI">Generate & Insert Image</button>
      <div id="aiStatus" style="margin-top:0.5rem; font-size:0.9rem; color:#555;"></div>
    </div>

    <button id="applyChanges">Apply Changes</button>
    <button id="downloadSite">Download Site</button>
    <button id="randomizeBtn">Randomize Site</button>
  </div>

  <iframe id="preview" sandbox="allow-same-origin allow-scripts"></iframe>

  <script>
    const preview = document.getElementById('preview');
    const sectionSelector = document.getElementById('sectionSelector');
    const sectionText = document.getElementById('sectionText');
    const sectionColor = document.getElementById('sectionColor');
    const bgType = document.getElementById('bgType');
    const bgColor = document.getElementById('bgColor');
    const bgImage = document.getElementById('bgImage');
    const theme = document.getElementById('theme');
    const imageUploader = document.getElementById('imageUploader');
    const aiPrompt = document.getElementById('aiPrompt');
    const generateAI = document.getElementById('generateAI');
    const aiStatus = document.getElementById('aiStatus');

    let baseHTML = `
      <header style="padding: 2rem; font-size: 2rem; text-align: center; color: #4A90E2;">
        Welcome to Your Site!
      </header>
      <section style="padding: 1.5rem; font-size: 1.2rem; color: #333;">
        <h2>About</h2>
        <p>This is a preview of your generated website. Use the editor to customize it!</p>
      </section>
      <footer style="padding: 1rem; font-size: 0.9rem; text-align: center; color: #777;">
        &copy; 2025 Your Company
      </footer>
    `;

    function prepareHTML(html) {
      const container = document.createElement('div');
      container.innerHTML = html;
      const elements = container.querySelectorAll('header, section, footer, div');
      elements.forEach((el, i) => {
        el.setAttribute('data-edit-id', i);
      });
      return container.innerHTML;
    }

    let currentHTML = prepareHTML(baseHTML);

    function renderPreview() {
      let bgStyle = '';
      if (bgType.value === 'color') {
        bgStyle = `background: ${bgColor.value};`;
      } else if (bgType.value === 'image' && bgImage.value.trim() !== '') {
        bgStyle = `background: url('${bgImage.value}') no-repeat center center / cover;`;
      }

      let themeStyles = '';
      switch (theme.value) {
        case 'modern':
          themeStyles = 'font-family: Inter, sans-serif;';
          break;
        case 'classic':
          themeStyles = 'font-family: serif;';
          break;
        case 'minimal':
          themeStyles = 'font-family: Arial, sans-serif; background: #fff; color: #222;';
          break;
        case 'vibrant':
          themeStyles = 'background: linear-gradient(135deg, #ff6a00, #ffd800); color: #fff;';
          break;
        case 'dark':
          themeStyles = 'background: #222; color: #fff;';
          break;
      }

      const fullHTML = `
        <!DOCTYPE html>
        <html lang="en">
          <head>
            <meta charset="UTF-8" />
            <meta name="viewport" content="width=device-width, initial-scale=1" />
            <title>Preview</title>
            <style>
              body { margin: 0; padding: 0; ${bgStyle} ${themeStyles} }
              img.section-image { max-width: 100%; height: auto; display: block; margin-top: 0.5rem; border-radius: 8px; }
            </style>
          </head>
          <body>
            ${currentHTML}
          </body>
        </html>
      `;
      preview.srcdoc = fullHTML;
      preview.onload = () => {
        populateSectionSelector();
      };
    }

    function populateSectionSelector() {
      const doc = preview.contentDocument;
      const editableSections = doc.querySelectorAll('[data-edit-id]');
      sectionSelector.innerHTML = '';
      editableSections.forEach((section) => {
        const id = section.getAttribute('data-edit-id');
        sectionSelector.appendChild(new Option(`${section.tagName} #${id}`, id));
      });
      if (editableSections.length > 0) {
        sectionSelector.value = '0';
        loadSection(0);
      }
    }

    function loadSection(id) {
      const doc = preview.contentDocument;
      const selected = doc.querySelector(`[data-edit-id="${id}"]`);
      if (!selected) return;
      sectionText.value = selected.innerHTML.trim();

      // Try to find image inside the section to get src if any
      const img = selected.querySelector('img.section-image');
      imageUploader.value = ''; // clear file input
      if (img) {
        sectionColor.value = rgbToHex(window.getComputedStyle(selected).color) || '#000000';
      } else {
        sectionColor.value = rgbToHex(window.getComputedStyle(selected).color) || '#000000';
      }
    }

    sectionSelector.addEventListener('change', (e) => {
      loadSection(e.target.value);
    });

    document.getElementById('applyChanges').addEventListener('click', () => {
      const doc = preview.contentDocument;
      const id = sectionSelector.value;
      const selected = doc.querySelector(`[data-edit-id="${id}"]`);
      if (!selected) return;

      // Update innerHTML and text color
      selected.innerHTML = sectionText.value;
      selected.style.color = sectionColor.value;

      // Update currentHTML from iframe
      currentHTML = doc.body.innerHTML;

      renderPreview();
    });

    bgType.addEventListener('change', () => {
      if (bgType.value === 'color') {
        bgColor.style.display = 'block';
        bgImage.style.display = 'none';
      } else {
        bgColor.style.display = 'none';
        bgImage.style.display = 'block';
      }
    });

    document.getElementById('downloadSite').addEventListener('click', () => {
      const doc = preview.contentDocument;
      const html = `<!DOCTYPE html>
      <html lang="en">
      <head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
      <title>Custom Website</title>
      <style>body{margin:0;padding:0;${bgType.value === 'color' ? `background:${bgColor.value};` : `background:url('${bgImage.value}') no-repeat center center / cover;`} ${
        {
          modern: 'font-family: Inter, sans-serif;',
          classic: 'font-family: serif;',
          minimal: 'font-family: Arial, sans-serif; background: #fff; color: #222;',
          vibrant: 'background: linear-gradient(135deg, #ff6a00, #ffd800); color: #fff;',
          dark: 'background: #222; color: #fff;',
        }[theme.value]
      }}</style></head><body>${doc.body.innerHTML}</body></html>`;

      const blob = new Blob([html], { type: 'text/html' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'custom-website.html';
      a.click();
    });

    // Randomize button logic
    document.getElementById('randomizeBtn').addEventListener('click', () => {
      function randColor() {
        const colors = [
          '#e74c3c',
          '#3498db',
          '#f1c40f',
          '#1abc9c',
          '#9b59b6',
          '#e67e22',
          '#2ecc71',
        ];
        return colors[Math.floor(Math.random() * colors.length)];
      }
      const themes = ['modern', 'classic', 'minimal', 'vibrant'];
      const bgColors = [
        '#f7f7f7',
        '#fffbf0',
        '#e0f7fa',
        '#f9fbe7',
        '#fff3e0',
        '#ede7f6',
        '#fffde7',
      ];

      const doc = preview.contentDocument;
      const sections = doc.querySelectorAll('[data-edit-id]');
      if (sections.length === 0) return;
      const randSection = sections[Math.floor(Math.random() * sections.length)];
      randSection.style.color = randColor();
      randSection.innerHTML = `<p>Randomized Content!</p>`;

      sectionSelector.value = randSection.getAttribute('data-edit-id');
      loadSection(sectionSelector.value);
      sectionColor.value = randSection.style.color;

      theme.value = themes[Math.floor(Math.random() * themes.length)];
      bgType.value = 'color';
      bgColor.style.display = 'block';
      bgImage.style.display = 'none';
      bgColor.value = bgColors[Math.floor(Math.random() * bgColors.length)];

      renderPreview();
    });

    // Handle image upload to current section
    imageUploader.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (event) {
        const dataUrl = event.target.result;
        const doc = preview.contentDocument;
        const selected = doc.querySelector(`[data-edit-id="${sectionSelector.value}"]`);
        if (!selected) return;

        // Remove existing section image if any
        const oldImg = selected.querySelector('img.section-image');
        if (oldImg) oldImg.remove();

        // Append new image with styling
        const img = doc.createElement('img');
        img.src = dataUrl;
        img.className = 'section-image';
        img.alt = 'Section image';

        selected.appendChild(img);

        // Update currentHTML and re-render
        currentHTML = doc.body.innerHTML;
        renderPreview();
      };
      reader.readAsDataURL(file);
    });

    // Simulated AI image generator (replace with real API)
    generateAI.addEventListener('click', () => {
      const prompt = aiPrompt.value.trim();
      if (!prompt) {
        aiStatus.textContent = 'Please enter a prompt to generate an image.';
        return;
      }
      aiStatus.textContent = 'Generating image... (simulated)';
      generateAI.disabled = true;

      // Simulate delay & generate placeholder image with prompt text
      setTimeout(() => {
        const placeholderURL = `https://via.placeholder.com/600x400.png?text=${encodeURIComponent(
          prompt.substring(0, 30)
        )}`;

        const doc = preview.contentDocument;
        const selected = doc.querySelector(`[data-edit-id="${sectionSelector.value}"]`);
        if (!selected) {
          aiStatus.textContent = 'Failed to find the selected section.';
          generateAI.disabled = false;
          return;
        }

        // Remove existing AI images if any
        const oldImg = selected.querySelector('img.section-image');
        if (oldImg) oldImg.remove();

        const img = doc.createElement('img');
        img.src = placeholderURL;
        img.className = 'section-image';
        img.alt = 'AI generated image';

        selected.appendChild(img);

        currentHTML = doc.body.innerHTML;
        renderPreview();

        aiStatus.textContent = 'Image generated and inserted!';
        generateAI.disabled = false;
        aiPrompt.value = '';
      }, 2500);
    });

    function rgbToHex(rgb) {
      if (!rgb) return '#000000';
      const result = rgb.match(/\d+/g);
      return result
        ? '#' +
            result
              .map((x) => (+x).toString(16).padStart(2, '0'))
              .join('')
        : '#000000';
    }

    // Initialize UI state and preview
    bgType.dispatchEvent(new Event('change'));
    currentHTML = prepareHTML(baseHTML);
    renderPreview();
  </script>
</body>
</html>
